#!/usr/bin/expect -f
#


package require cmdline

set options {
        {t.arg 1 "Expect timeout [s]"}
        {w.arg 500 "Crossterm poll wait time [ms]"}
}
set usage ": prog \[options]"
array set params [::cmdline::getoptions argv $options $usage]

set pwt $params(w)
set timeout $params(t)


spawn ../target/debug/termal --poll-wait-time $pwt -w 20 -t 10 data/test-aln-02.fas
match_max 100000
expect {
	expect -exact "\[?1049h\[1;1H\[J\[2;1H\[J\[3;1H\[J\[4;1H\[J\[5;1H\[J\[6;1H\[J\[7;1H\[J\[8;1H\[J\[9;1H\[J\[10;1H\[J\[1;1H\[38;5;15m┌─────────────┐┌ da┐\[2;1H│s1           ││\[38;2;255;165;0mAAA\[38;5;15m│\[3;1H│s2           ││\[38;2;255;165;0mAAA\[38;5;15m│\[4;1H│s3           ││\[38;2;255;165;0mAAA\[38;5;15m│\[5;1H└─────────────┘└───┘\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;14H\[38;5;15m┐┌ dat\[2;14H│\[2;16H\[38;2;255;165;0mA\[3;14H\[38;5;15m│\[3;16H\[38;2;255;165;0mA\[4;14H\[38;5;15m│\[4;16H\[38;2;255;165;0mA\[5;14H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;13H\[38;5;15m┐┌ data\[2;13H│\[2;15H\[38;2;255;165;0mA\[3;13H\[38;5;15m│\[3;15H\[38;2;255;165;0mA\[4;13H\[38;5;15m│\[4;15H\[38;2;255;165;0mA\[5;13H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;12H\[38;5;15m┐┌ data/\[2;12H│\[2;14H\[38;2;255;165;0mA\[3;12H\[38;5;15m│\[3;14H\[38;2;255;165;0mA\[4;12H\[38;5;15m│\[4;14H\[38;2;255;165;0mA\[5;12H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;11H\[38;5;15m┐┌ data/t\[2;11H│\[2;13H\[38;2;255;165;0mA\[3;11H\[38;5;15m│\[3;13H\[38;2;255;165;0mA\[4;11H\[38;5;15m│\[4;13H\[38;2;255;165;0mA\[5;11H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;10H\[38;5;15m┐┌ data/te\[2;10H│\[2;12H\[38;2;255;165;0mA\[3;10H\[38;5;15m│\[3;12H\[38;2;255;165;0mA\[4;10H\[38;5;15m│\[4;12H\[38;2;255;165;0mA\[5;10H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;9H\[38;5;15m┐┌ data/tes\[2;9H│\[2;11H\[38;2;255;165;0mA\[3;9H\[38;5;15m│\[3;11H\[38;2;255;165;0mA\[4;9H\[38;5;15m│\[4;11H\[38;2;255;165;0mA\[5;9H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;8H\[38;5;15m┐┌ data/test\[2;8H│\[2;10H\[38;2;255;165;0mA\[3;8H\[38;5;15m│\[3;10H\[38;2;255;165;0mA\[4;8H\[38;5;15m│\[4;10H\[38;2;255;165;0mA\[5;8H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;7H\[38;5;15m┐┌ data/test-\[2;7H│\[2;9H\[38;2;255;165;0mA\[2;19H\[38;5;5mQ\[3;7H\[38;5;15m│\[3;9H\[38;2;255;165;0mA\[3;19H\[38;5;5mQ\[4;7H\[38;5;15m│\[4;9H\[38;2;255;165;0mA\[4;19H\[38;5;5mQ\[5;7H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;6H\[38;5;15m┐┌ data/test-a\[2;6H│\[2;8H\[38;2;255;165;0mA\[2;18H\[38;5;5mQ\[3;6H\[38;5;15m│\[3;8H\[38;2;255;165;0mA\[3;18H\[38;5;5mQ\[4;6H\[38;5;15m│\[4;8H\[38;2;255;165;0mA\[4;18H\[38;5;5mQ\[5;6H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;5H\[38;5;15m┐┌ data/test-al\[2;5H│\[2;7H\[38;2;255;165;0mA\[2;17H\[38;5;5mQ\[3;5H\[38;5;15m│\[3;7H\[38;2;255;165;0mA\[3;17H\[38;5;5mQ\[4;5H\[38;5;15m│\[4;7H\[38;2;255;165;0mA\[4;17H\[38;5;5mQ\[5;5H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;4H\[38;5;15m┐┌ data/test-aln\[2;4H│\[2;6H\[38;2;255;165;0mA\[2;16H\[38;5;5mQ\[3;4H\[38;5;15m│\[3;6H\[38;2;255;165;0mA\[3;16H\[38;5;5mQ\[4;4H\[38;5;15m│\[4;6H\[38;2;255;165;0mA\[4;16H\[38;5;5mQ\[5;4H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;3H\[38;5;15m┐┌ data/test-aln-\[2;3H│\[2;5H\[38;2;255;165;0mA\[2;15H\[38;5;5mQ\[3;3H\[38;5;15m│\[3;5H\[38;2;255;165;0mA\[3;15H\[38;5;5mQ\[4;3H\[38;5;15m│\[4;5H\[38;2;255;165;0mA\[4;15H\[38;5;5mQ\[5;3H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;2H\[38;5;15m┐┌ data/test-aln-0\[2;2H│\[2;4H\[38;2;255;165;0mA\[2;14H\[38;5;5mQ\[3;2H\[38;5;15m│\[3;4H\[38;2;255;165;0mA\[3;14H\[38;5;5mQ\[4;2H\[38;5;15m│\[4;4H\[38;2;255;165;0mA\[4;14H\[38;5;5mQ\[5;2H\[38;5;15m┘└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;2H\[38;5;15m┌ data/test-aln-02\[2;3H\[38;2;255;165;0mA\[2;13H\[38;5;5mQ\[3;3H\[38;2;255;165;0mA\[3;13H\[38;5;5mQ\[4;3H\[38;2;255;165;0mA\[4;13H\[38;5;5mQ\[5;2H\[38;5;15m└─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "<"
expect {
	expect -exact "\[1;2H\[38;5;15m data/test-aln-02.\[2;2H\[38;2;255;165;0mA\[2;12H\[38;5;5mQ\[3;2H\[38;2;255;165;0mA\[3;12H\[38;5;5mQ\[4;2H\[38;2;255;165;0mA\[4;12H\[38;5;5mQ\[5;2H\[38;5;15m─\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;2H\[38;5;15m┌ data/test-aln-02\[2;2H│\[2;12H\[38;2;255;165;0mA\[3;2H\[38;5;15m│\[3;12H\[38;2;255;165;0mA\[4;2H\[38;5;15m│\[4;12H\[38;2;255;165;0mA\[5;2H\[38;5;15m└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;2H\[38;5;15m┐┌ data/test-aln-0\[2;3H│\[2;13H\[38;2;255;165;0mA\[3;3H\[38;5;15m│\[3;13H\[38;2;255;165;0mA\[4;3H\[38;5;15m│\[4;13H\[38;2;255;165;0mA\[5;2H\[38;5;15m┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;2H\[38;5;15m─┐┌ data/test-aln-\[2;2Hs\[2;4H│\[2;14H\[38;2;255;165;0mA\[3;2H\[38;5;15ms\[3;4H│\[3;14H\[38;2;255;165;0mA\[4;2H\[38;5;15ms\[4;4H│\[4;14H\[38;2;255;165;0mA\[5;2H\[38;5;15m─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;3H\[38;5;15m─┐┌ data/test-aln\[2;3H1\[2;5H│\[2;15H\[38;2;255;165;0mA\[3;3H\[38;5;15m2\[3;5H│\[3;15H\[38;2;255;165;0mA\[4;3H\[38;5;15m3\[4;5H│\[4;15H\[38;2;255;165;0mA\[5;3H\[38;5;15m─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;4H\[38;5;15m─┐┌ data/test-al\[2;4H \[2;6H│\[2;16H\[38;2;255;165;0mA\[3;4H\[38;5;15m \[3;6H│\[3;16H\[38;2;255;165;0mA\[4;4H\[38;5;15m \[4;6H│\[4;16H\[38;2;255;165;0mA\[5;4H\[38;5;15m─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;5H\[38;5;15m─┐┌ data/test-a\[2;5H \[2;7H│\[2;17H\[38;2;255;165;0mA\[3;5H\[38;5;15m \[3;7H│\[3;17H\[38;2;255;165;0mA\[4;5H\[38;5;15m \[4;7H│\[4;17H\[38;2;255;165;0mA\[5;5H\[38;5;15m─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;6H\[38;5;15m─┐┌ data/test-\[2;6H \[2;8H│\[2;18H\[38;2;255;165;0mA\[3;6H\[38;5;15m \[3;8H│\[3;18H\[38;2;255;165;0mA\[4;6H\[38;5;15m \[4;8H│\[4;18H\[38;2;255;165;0mA\[5;6H\[38;5;15m─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;7H\[38;5;15m─┐┌ data/test\[2;7H \[2;9H│\[2;19H\[38;2;255;165;0mA\[3;7H\[38;5;15m \[3;9H│\[3;19H\[38;2;255;165;0mA\[4;7H\[38;5;15m \[4;9H│\[4;19H\[38;2;255;165;0mA\[5;7H\[38;5;15m─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;8H\[38;5;15m─┐┌ data/tes\[2;8H \[2;10H│\[3;8H \[3;10H│\[4;8H \[4;10H│\[5;8H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;9H\[38;5;15m─┐┌ data/te\[2;9H \[2;11H│\[3;9H \[3;11H│\[4;9H \[4;11H│\[5;9H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;10H\[38;5;15m─┐┌ data/t\[2;10H \[2;12H│\[3;10H \[3;12H│\[4;10H \[4;12H│\[5;10H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;11H\[38;5;15m─┐┌ data/\[2;11H \[2;13H│\[3;11H \[3;13H│\[4;11H \[4;13H│\[5;11H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;12H\[38;5;15m─┐┌ data\[2;12H \[2;14H│\[3;12H \[3;14H│\[4;12H \[4;14H│\[5;12H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;13H\[38;5;15m─┐┌ dat\[2;13H \[2;15H│\[3;13H \[3;15H│\[4;13H \[4;15H│\[5;13H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;14H\[38;5;15m─┐┌ da\[2;14H \[2;16H│\[3;14H \[3;16H│\[4;14H \[4;16H│\[5;14H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;15H\[38;5;15m─┐┌ d\[2;15H \[2;17H│\[3;15H \[3;17H│\[4;15H \[4;17H│\[5;15H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;16H\[38;5;15m─┐┌ \[2;16H \[2;18H│\[3;16H \[3;18H│\[4;16H \[4;18H│\[5;16H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;17H\[38;5;15m─┐┌\[2;17H \[2;19H│\[3;17H \[3;19H│\[4;17H \[4;19H│\[5;17H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;18H\[38;5;15m─┐┌\[2;18H \[3;18H \[4;18H \[5;18H─┘└\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- ">"
expect {
	expect -exact "\[1;19H\[38;5;15m─┐\[2;19H \[3;19H \[4;19H \[5;19H─┘\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l\[39m\[49m\[59m\[0m\[?25l" {} 
	default { exit 1 }
}
send -- "q"
expect eof
	
# Gets the exit code of the spawned process, so that this script fails IFF it 
# did. 
catch wait result 
set prog_exit_code [lindex $result 3] 
exit $prog_exit_code
